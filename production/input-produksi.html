<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">
    <title>NILAMTRACE - Input Produksi</title>
    
    <!-- Ikon Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Akses CSS -->
    <link rel="stylesheet" href="../assets/css/style.css">
    <link rel="stylesheet" href="../assets/css/form.css">
</head>
<body>
    <!-- Skip Navigation -->
    <a href="#mainContent" class="skip-link">Lewati ke konten utama</a>
    
    <!-- Navigation Header -->
    <header role="banner">
        <div class="header-container">
            <!-- Hamburger Menu untuk Mobile -->
            <button class="hamburger-btn" id="hamburgerBtn" aria-label="Buka menu navigasi" aria-expanded="false" aria-controls="sidebar">
                <i class="fas fa-bars" aria-hidden="true"></i>
            </button>
            
            <!-- Logo -->
            <div class="logo">
                <img src="../assets/images/nilam.png" alt="Tanaman Nilam" class="logo-img"/>
                <div class="logo-text">
                    <h1>NILAMTRACE</h1>
                    <span id="locationInfo">Desa Teuladan</span>
                </div>
            </div>
            
            <!-- Profile Dropdown -->
            <div class="profile-dropdown" id="profileDropdown">
                <button class="profile-btn" id="profileBtn" aria-label="Menu profil pengguna" aria-expanded="false" aria-haspopup="true">
                    <div class="profile-avatar" aria-hidden="true">
                        <i class="fas fa-user"></i>
                    </div>
                    <span class="profile-name">Petani Nilam</span>
                    <i class="fas fa-chevron-down" aria-hidden="true"></i>
                </button>
                <div class="dropdown-menu" id="dropdownMenu" role="menu" aria-labelledby="profileBtn">
                    <div class="dropdown-header">
                        <div class="dropdown-avatar">
                            <i class="fas fa-user"></i>
                        </div>
                        <div class="dropdown-info">
                            <h4>Petani Nilam</h4>
                            <p>petani@nilam.com</p>
                        </div>
                    </div>
                    <div class="dropdown-divider"></div>
                    <a href="../auth/profile.html" class="dropdown-item">
                        <i class="fas fa-user-circle"></i>
                        <span>Profil Saya</span>
                    </a>
                    <a href="../auth/profile.html#settings" class="dropdown-item">
                        <i class="fas fa-cog"></i>
                        <span>Pengaturan</span>
                    </a>
                    <div class="dropdown-divider"></div>
                    <a href="#" class="dropdown-item logout" id="logoutBtn">
                        <i class="fas fa-sign-out-alt"></i>
                        <span>Keluar</span>
                    </a>
                </div>
            </div>
        </div>
    </header>

    <!-- Sidebar Navigation -->
    <nav class="sidebar" id="sidebar" role="navigation" aria-label="Menu navigasi utama">
        <div class="sidebar-header">
            <div class="sidebar-logo">
                <img src="../assets/images/nilam.png" alt="Logo NILAMTRACE"/>
                <h3>NILAMTRACE</h3>
            </div>
            <button class="close-sidebar" id="closeSidebar" aria-label="Tutup menu navigasi">
                <i class="fas fa-times" aria-hidden="true"></i>
            </button>
        </div>
        
        <div class="sidebar-menu">
            <a href="../homepage/homepage.html" class="menu-item">
                <i class="fas fa-home"></i>
                <span>Dashboard</span>
            </a>
            
            <a href="../monitoring/monitoring.html" class="menu-item">
                <i class="fas fa-camera"></i>
                <span>Deteksi Penyakit</span>
            </a>
            
            <a href="input-produksi.html" class="menu-item active">
                <i class="fas fa-seedling"></i>
                <span>Input Produksi</span>
            </a>
            

            <a href="#" class="menu-item">
                <i class="fas fa-calendar-alt"></i>
                <span>Jadwal Panen</span>
            </a>
            
            <a href="#" class="menu-item">
                <i class="fas fa-file-alt"></i>
                <span>Laporan</span>
            </a>
            
            <a href="#" class="menu-item">
                <i class="fas fa-book"></i>
                <span>Panduan</span>
            </a>
            
            <div class="menu-divider"></div>
            
            <a href="../auth/profile.html" class="menu-item">
                <i class="fas fa-user-cog"></i>
                <span>Pengaturan Akun</span>
            </a>
            
            <a href="#" class="menu-item" id="themeToggle">
                <i class="fas fa-moon"></i>
                <span>Mode Gelap</span>
            </a>
        </div>
        
        <div class="sidebar-footer">
            <div class="user-info">
                <div class="user-avatar">
                    <i class="fas fa-user"></i>
                </div>
                <div class="user-details">
                    <h4>Petani Nilam</h4>
                    <p>Desa Teuladan</p>
                </div>
            </div>
            <button class="logout-btn" id="sidebarLogout">
                <i class="fas fa-sign-out-alt"></i>
            </button>
        </div>
    </nav>

    <!-- Overlay untuk mobile -->
    <div class="overlay" id="overlay"></div>

    <!-- Main Content -->
    <main class="main-content" id="mainContent" role="main" aria-label="Konten utama input produksi">
        <div class="container">
            <!-- Page Header -->
            <header class="page-header">
                <div class="header-left">
                    <h1><i class="fas fa-seedling" aria-hidden="true"></i> Input Data Produksi & Tanaman</h1>
                    <p class="page-subtitle">Kelola data produksi panen dan tanaman nilam Anda di satu tempat</p>
                </div>
                <div class="header-actions">
                    <button class="btn btn-help" id="quickGuideBtn" aria-label="Buka panduan cepat penggunaan">
                        <i class="fas fa-question-circle" aria-hidden="true"></i>
                        Panduan Cepat
                    </button>
                    <button class="btn btn-success" id="exportDataBtn" aria-label="Ekspor data produksi">
                        <i class="fas fa-file-export" aria-hidden="true"></i>
                        Ekspor Data
                    </button>
                </div>
            </header>

            <!-- Tab Container -->
            <div class="tab-container" id="tabContainer" role="tablist" aria-label="Tab navigasi input data">
                <button class="tab-btn active" data-tab="produksi" role="tab" aria-selected="true" aria-controls="tab-produksi" id="produksiTab">
                    <i class="fas fa-weight" aria-hidden="true"></i>
                    Input Produksi Panen
                </button>
                <button class="tab-btn" data-tab="tanaman" role="tab" aria-selected="false" aria-controls="tab-tanaman" id="tanamanTab">
                    <i class="fas fa-seedling" aria-hidden="true"></i>
                    Input Data Tanaman
                </button>
                <button class="tab-btn" data-tab="riwayat" role="tab" aria-selected="false" aria-controls="tab-riwayat" id="riwayatTab">
                    <i class="fas fa-history" aria-hidden="true"></i>
                    Riwayat Produksi
                </button>
            </div>

            <!-- Info Box -->
            <div class="info-box">
                <div class="info-icon">
                    <i class="fas fa-info-circle"></i>
                </div>
                <div class="info-content">
                    <h3>Informasi Penting</h3>
                    <p>Input data produksi panen dan data tanaman secara terpisah. Data tanaman yang diinput akan digunakan untuk analisis pada dashboard utama dan estimasi produksi.</p>
                </div>
            </div>

            <!-- Tab Content: Input Produksi -->
            <div class="tab-content active" id="tab-produksi">
                <div class="card">
                    <div class="form-header">
                        <h2><i class="fas fa-weight"></i> Input Data Produksi Panen</h2>
                        <p class="form-subtitle">Isi data produksi panen nilam untuk pencatatan dan analisis</p>
                    </div>
                    
                    <form id="productionForm">
                        <div class="form-row">
                            <div class="form-group">
                                <label for="tanggal">
                                    <i class="fas fa-calendar-alt" aria-hidden="true"></i>
                                    Tanggal Panen <span class="required" aria-label="wajib diisi">*</span>
                                </label>
                                <input type="date" id="tanggal" name="tanggal" required aria-describedby="tanggal-hint">
                                <small class="form-hint" id="tanggal-hint">Tanggal ketika panen dilakukan</small>
                            </div>
                            
                            <div class="form-group">
                                <label for="jenisProduk">
                                    <i class="fas fa-box" aria-hidden="true"></i>
                                    Jenis Produk <span class="required" aria-label="wajib diisi">*</span>
                                </label>
                                <select id="jenisProduk" name="jenisProduk" required aria-describedby="jenisProduk-hint">
                                    <option value="">Pilih Jenis Produk</option>
                                    <option value="daun_segar">Daun Segar</option>
                                    <option value="minyak_nilam">Minyak Nilam</option>
                                    <option value="sabut_nilam">Sabut Nilam</option>
                                    <option value="bibit">Bibit</option>
                                    <option value="lainnya">Lainnya</option>
                                </select>
                                <small class="form-hint" id="jenisProduk-hint">Jenis produk yang dihasilkan</small>
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label for="jumlahProduksi">
                                    <i class="fas fa-balance-scale" aria-hidden="true"></i>
                                    Jumlah Produksi <span class="required" aria-label="wajib diisi">*</span>
                                </label>
                                <div class="input-with-unit">
                                    <input type="number" id="jumlahProduksi" name="jumlahProduksi" min="0" step="0.01" required aria-describedby="jumlahProduksi-hint">
                                    <span class="input-unit" aria-hidden="true">kg</span>
                                </div>
                                <small class="form-hint" id="jumlahProduksi-hint">Jumlah produksi dalam kilogram</small>
                            </div>
                            
                            <div class="form-group">
                                <label for="hargaJual">
                                    <i class="fas fa-money-bill-wave" aria-hidden="true"></i>
                                    Harga Jual per kg <span class="required" aria-label="wajib diisi">*</span>
                                </label>
                                <div class="input-with-unit">
                                    <input type="number" id="hargaJual" name="hargaJual" min="0" required aria-describedby="hargaJual-hint">
                                    <span class="input-unit" aria-hidden="true">Rp</span>
                                </div>
                                <small class="form-hint" id="hargaJual-hint">Harga jual per kilogram produk</small>
                            </div>
                        </div>
                        
                        <!-- Auto-calculated Total -->
                        <div class="form-group total-display-group">
                            <label>
                                <i class="fas fa-calculator"></i>
                                Total Pendapatan
                            </label>
                            <div class="total-display" id="totalPendapatanDisplay">
                                <span class="total-label">Rp</span>
                                <span class="total-value">0</span>
                            </div>
                            <small class="form-hint">Total dihitung otomatis dari Jumlah × Harga</small>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label for="kualitas">
                                    <i class="fas fa-star"></i>
                                    Kualitas Produk
                                </label>
                                <select id="kualitas" name="kualitas" required>
                                    <option value="">Pilih Kualitas</option>
                                    <option value="premium">Premium (Grade A)</option>
                                    <option value="standar">Standar (Grade B)</option>
                                    <option value="ekonomi">Ekonomi (Grade C)</option>
                                </select>
                                <small class="form-hint">Tingkat kualitas produk hasil panen</small>
                            </div>
                            
                            <div class="form-group">
                                <label for="lokasiPanen">
                                    <i class="fas fa-map-marker-alt"></i>
                                    Lokasi Panen
                                </label>
                                <input type="text" id="lokasiPanen" name="lokasiPanen" placeholder="Contoh: Blok A, Desa Teuladan">
                                <small class="form-hint">Lokasi dimana panen dilakukan</small>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label for="keterangan">
                                <i class="fas fa-sticky-note"></i>
                                Keterangan Tambahan
                            </label>
                            <textarea id="keterangan" name="keterangan" rows="3" placeholder="Contoh: Panen musim pertama, hasil distilasi, kondisi cuaca, dll..."></textarea>
                            <small class="form-hint">Catatan tambahan tentang produksi ini</small>
                        </div>
                        
                        <div class="form-actions">
                            <button type="reset" class="btn btn-secondary">
                                <i class="fas fa-redo"></i>
                                Reset Form
                            </button>
                            <button type="submit" class="btn btn-primary">
                                <i class="fas fa-save"></i>
                                Simpan Data Produksi
                            </button>
                        </div>
                    </form>
                </div>
                
                <!-- Quick Calculator -->
                <div class="card calculator-card">
                    <div class="calculator-header">
                        <h3><i class="fas fa-calculator"></i> Kalkulator Produksi</h3>
                        <p>Hitung estimasi pendapatan dengan cepat</p>
                    </div>
                    <div class="calculator-body">
                        <div class="calculator-inputs">
                            <div class="calc-group">
                                <label>Jumlah (kg)</label>
                                <input type="number" id="calcJumlah" min="0" step="0.01" value="0">
                            </div>
                            <div class="calc-group">
                                <label>Harga/kg (Rp)</label>
                                <input type="number" id="calcHarga" min="0" value="0">
                            </div>
                            <div class="calc-group">
                                <label>Total (Rp)</label>
                                <div class="calc-result" id="calcTotal">0</div>
                            </div>
                        </div>
                        <button class="btn btn-sm" id="applyCalcBtn">
                            <i class="fas fa-arrow-right"></i>
                            Terapkan ke Form
                        </button>
                    </div>
                </div>
            </div>

            <!-- Tab Content: Input Tanaman -->
            <div class="tab-content" id="tab-tanaman">
                <div class="card">
                    <div class="form-header">
                        <h2><i class="fas fa-seedling"></i> Input Data Tanaman Nilam</h2>
                        <p class="form-subtitle">Kelola data tanaman nilam untuk monitoring dan analisis</p>
                    </div>
                    
                    <form id="tanamanForm">
                        <div class="form-row">
                            <div class="form-group">
                                <label for="namaVarietas">
                                    <i class="fas fa-tag"></i>
                                    Nama Varietas
                                </label>
                                <input type="text" id="namaVarietas" name="namaVarietas" required placeholder="Contoh: Nilam Aceh, Nilam Jawa">
                                <small class="form-hint">Jenis varietas tanaman nilam</small>
                            </div>
                            
                            <div class="form-group">
                                <label for="tanggalTanam">
                                    <i class="fas fa-calendar-plus"></i>
                                    Tanggal Tanam
                                </label>
                                <input type="date" id="tanggalTanam" name="tanggalTanam" required>
                                <small class="form-hint">Tanggal ketika tanaman ditanam</small>
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label for="jumlahBatang">
                                    <i class="fas fa-tree"></i>
                                    Jumlah Batang
                                </label>
                                <div class="input-with-unit">
                                    <input type="number" id="jumlahBatang" name="jumlahBatang" min="1" required>
                                    <span class="input-unit">batang</span>
                                </div>
                                <small class="form-hint">Total jumlah batang tanaman</small>
                            </div>
                            
                            <div class="form-group">
                                <label for="luasLahan">
                                    <i class="fas fa-ruler-combined"></i>
                                    Luas Lahan
                                </label>
                                <div class="input-with-unit">
                                    <input type="number" id="luasLahan" name="luasLahan" min="1" step="0.01" required>
                                    <span class="input-unit">m²</span>
                                </div>
                                <small class="form-hint">Luas lahan yang digunakan</small>
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label for="lokasiTanam">
                                    <i class="fas fa-map-marked-alt"></i>
                                    Lokasi Tanam
                                </label>
                                <input type="text" id="lokasiTanam" name="lokasiTanam" required placeholder="Contoh: Blok A, Desa Teuladan">
                                <small class="form-hint">Lokasi spesifik tanaman ditanam</small>
                            </div>
                            
                            <div class="form-group">
                                <label for="statusTanaman">
                                    <i class="fas fa-heartbeat"></i>
                                    Status Tanaman
                                </label>
                                <select id="statusTanaman" name="statusTanaman" required>
                                    <option value="">Pilih Status</option>
                                    <option value="aktif">Aktif/Berkembang</option>
                                    <option value="panen">Siap Panen</option>
                                    <option value="baru">Tanaman Baru</option>
                                    <option value="masa-pemeliharaan">Masa Pemeliharaan</option>
                                    <option value="sakit">Terkena Penyakit</option>
                                </select>
                                <small class="form-hint">Kondisi terkini tanaman</small>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label for="catatanTanaman">
                                <i class="fas fa-clipboard-list"></i>
                                Catatan Tambahan
                            </label>
                            <textarea id="catatanTanaman" name="catatanTanaman" rows="3" placeholder="Kondisi tanah, perawatan khusus, pemupukan, hama, dll..."></textarea>
                            <small class="form-hint">Catatan penting tentang tanaman ini</small>
                        </div>
                        
                        <div class="form-actions">
                            <button type="reset" class="btn btn-secondary">
                                <i class="fas fa-redo"></i>
                                Reset Form
                            </button>
                            <button type="submit" class="btn btn-primary">
                                <i class="fas fa-save"></i>
                                Simpan Data Tanaman
                            </button>
                        </div>
                    </form>
                </div>
                
                <!-- Plant Stats Summary -->
                <div class="card stats-summary">
                    <div class="stats-header">
                        <h3><i class="fas fa-chart-pie"></i> Ringkasan Tanaman</h3>
                        <p>Statistik tanaman berdasarkan status</p>
                    </div>
                    <div class="stats-body">
                        <div class="stats-grid">
                            <div class="stat-item">
                                <div class="stat-icon active">
                                    <i class="fas fa-leaf"></i>
                                </div>
                                <div class="stat-content">
                                    <h4>Aktif</h4>
                                    <div class="stat-value" id="plantActiveCount">0</div>
                                </div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-icon ready">
                                    <i class="fas fa-apple-alt"></i>
                                </div>
                                <div class="stat-content">
                                    <h4>Siap Panen</h4>
                                    <div class="stat-value" id="plantReadyCount">0</div>
                                </div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-icon new">
                                    <i class="fas fa-seedling"></i>
                                </div>
                                <div class="stat-content">
                                    <h4>Tanaman Baru</h4>
                                    <div class="stat-value" id="plantNewCount">0</div>
                                </div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-icon sick">
                                    <i class="fas fa-first-aid"></i>
                                </div>
                                <div class="stat-content">
                                    <h4>Terkena Penyakit</h4>
                                    <div class="stat-value" id="plantSickCount">0</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Tab Content: Riwayat Produksi -->
            <div class="tab-content" id="tab-riwayat">
                <div class="card">
                    <div class="card-header">
                        <h2><i class="fas fa-history"></i> Riwayat Produksi</h2>
                        <div class="card-actions">
                            <div class="filter-group">
                                <select id="filterPeriod">
                                    <option value="all">Semua Periode</option>
                                    <option value="today">Hari Ini</option>
                                    <option value="week">Minggu Ini</option>
                                    <option value="month">Bulan Ini</option>
                                    <option value="year">Tahun Ini</option>
                                </select>
                                <select id="filterProduct">
                                    <option value="all">Semua Produk</option>
                                    <option value="daun_segar">Daun Segar</option>
                                    <option value="minyak_nilam">Minyak Nilam</option>
                                    <option value="sabut_nilam">Sabut Nilam</option>
                                    <option value="bibit">Bibit</option>
                                </select>
                            </div>
                            <button class="btn btn-secondary" id="clearHistoryBtn">
                                <i class="fas fa-trash"></i>
                                Hapus Riwayat
                            </button>
                        </div>
                    </div>
                    
                    <div class="table-responsive">
                        <table id="riwayatProduksi">
                            <thead>
                                <tr>
                                    <th>Tanggal</th>
                                    <th>Jenis Produk</th>
                                    <th>Jumlah (kg)</th>
                                    <th>Harga/kg (Rp)</th>
                                    <th>Total (Rp)</th>
                                    <th>Kualitas</th>
                                    <th>Aksi</th>
                                </tr>
                            </thead>
                            <tbody>
                                <!-- Data riwayat akan diisi oleh JavaScript -->
                                <tr class="empty-row">
                                    <td colspan="7" class="empty-state">
                                        <i class="fas fa-history"></i>
                                        <p>Belum ada data produksi. Mulai dengan input data produksi pertama Anda.</p>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    
                    <div class="table-footer">
                        <div class="summary-info">
                            <div class="summary-item">
                                <span class="summary-label">Total Produksi:</span>
                                <span class="summary-value" id="totalProductionSum">0 kg</span>
                            </div>
                            <div class="summary-item">
                                <span class="summary-label">Total Pendapatan:</span>
                                <span class="summary-value" id="totalRevenueSum">Rp 0</span>
                            </div>
                            <div class="summary-item">
                                <span class="summary-label">Rata-rata Harga/kg:</span>
                                <span class="summary-value" id="avgPriceSum">Rp 0</span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Export Options -->
                <div class="card export-card">
                    <div class="export-header">
                        <h3><i class="fas fa-file-export"></i> Ekspor Data</h3>
                        <p>Unduh data produksi dalam berbagai format</p>
                    </div>
                    <div class="export-options">
                        <button class="export-btn pdf">
                            <i class="fas fa-file-pdf"></i>
                            PDF Report
                        </button>
                        <button class="export-btn excel">
                            <i class="fas fa-file-excel"></i>
                            Excel
                        </button>
                        <button class="export-btn csv">
                            <i class="fas fa-file-csv"></i>
                            CSV
                        </button>
                        <button class="export-btn print">
                            <i class="fas fa-print"></i>
                            Cetak
                        </button>
                    </div>
                </div>
            </div>

            <!-- Daftar Tanaman -->
            <div class="card plants-card">
                <div class="card-header">
                    <h2><i class="fas fa-list"></i> Daftar Tanaman Terdaftar</h2>
                    <div class="plants-filter">
                        <input type="text" id="plantSearch" placeholder="Cari tanaman...">
                        <select id="plantStatusFilter">
                            <option value="all">Semua Status</option>
                            <option value="aktif">Aktif</option>
                            <option value="panen">Siap Panen</option>
                            <option value="baru">Baru</option>
                            <option value="sakit">Sakit</option>
                        </select>
                    </div>
                </div>
                
                <div class="plants-list" id="plantsList">
                    <!-- Data tanaman akan diisi oleh JavaScript -->
                    <div class="empty-plants">
                        <i class="fas fa-seedling"></i>
                        <p>Belum ada data tanaman. Tambahkan data tanaman terlebih dahulu.</p>
                    </div>
                </div>
            </div>

            <!-- Quick Tips -->
            <div class="card tips-card">
                <div class="tips-header">
                    <h3><i class="fas fa-lightbulb"></i> Tips Input Data</h3>
                </div>
                <div class="tips-content">
                    <div class="tip-item">
                        <div class="tip-icon">
                            <i class="fas fa-calendar-check"></i>
                        </div>
                        <div class="tip-text">
                            <h4>Input Rutin</h4>
                            <p>Input data produksi segera setelah panen untuk akurasi data yang lebih baik.</p>
                        </div>
                    </div>
                    <div class="tip-item">
                        <div class="tip-icon">
                            <i class="fas fa-ruler"></i>
                        </div>
                        <div class="tip-text">
                            <h4>Ukur dengan Akurat</h4>
                            <p>Gunakan timbangan yang terkalibrasi untuk mengukur jumlah produksi.</p>
                        </div>
                    </div>
                    <div class="tip-item">
                        <div class="tip-icon">
                            <i class="fas fa-sticky-note"></i>
                        </div>
                        <div class="tip-text">
                            <h4>Catat Detail</h4>
                            <p>Selalu tambahkan keterangan untuk membantu analisis di masa depan.</p>
                        </div>
                    </div>
                    <div class="tip-item">
                        <div class="tip-icon">
                            <i class="fas fa-sync-alt"></i>
                        </div>
                        <div class="tip-text">
                            <h4>Perbarui Status</h4>
                            <p>Update status tanaman secara berkala untuk monitoring yang efektif.</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Footer -->
    <footer>
        <div class="footer-content">
            <p>NILAMTRACE - Sistem Manajemen Produksi Tanaman Nilam</p>
            <p>Desa Teuladan, Kecamatan Seulimum, Kabupaten Aceh Besar</p>
            <div class="footer-info">
                <span id="dataStats">Total Produksi: 0 kg | Total Tanaman: 0 batang</span>
                <span class="divider">|</span>
                <span id="lastUpdate">Update Terakhir: -</span>
            </div>
        </div>
    </footer>

    <!-- JavaScript -->
    <script src="../assets/js/common.js"></script>
    <script src="../assets/js/production.js"></script>
</body>
</html>
            // Load user data
            function loadUserData() {
                const userData = JSON.parse(localStorage.getItem('user')) || {
                    name: 'Petani Nilam',
                    email: 'petani@nilam.com',
                    village: 'Desa Teuladan'
                };
                
                // Update profile elements
                document.querySelectorAll('.profile-name, .dropdown-info h4').forEach(el => {
                    if (el.classList.contains('profile-name')) {
                        el.textContent = userData.name;
                    } else {
                        el.textContent = userData.name;
                    }
                });
                
                document.querySelector('.dropdown-info p').textContent = userData.email;
                document.querySelector('.user-details h4').textContent = userData.name;
                document.querySelector('.user-details p').textContent = userData.village;
            }
            
            // Navigation Control
            const hamburgerBtn = document.getElementById('hamburgerBtn');
            const closeSidebar = document.getElementById('closeSidebar');
            const sidebar = document.getElementById('sidebar');
            const overlay = document.getElementById('overlay');
            const profileBtn = document.getElementById('profileBtn');
            const dropdownMenu = document.getElementById('dropdownMenu');
            
            // Toggle Sidebar
            function toggleSidebar() {
                sidebar.classList.toggle('active');
                overlay.classList.toggle('active');
                document.body.classList.toggle('sidebar-active');
            }
            
            // Toggle Profile Dropdown
            function toggleProfileDropdown() {
                const profileDropdown = document.getElementById('profileDropdown');
                if (dropdownMenu && profileDropdown) {
                    dropdownMenu.classList.toggle('show');
                    profileDropdown.classList.toggle('active');
                }
            }
            
            // Event Listeners
            hamburgerBtn.addEventListener('click', toggleSidebar);
            closeSidebar.addEventListener('click', toggleSidebar);
            overlay.addEventListener('click', toggleSidebar);
            
            if (profileBtn) {
                profileBtn.addEventListener('click', function(e) {
                    e.stopPropagation();
                    toggleProfileDropdown();
                });
            }
            
            // Close dropdown when clicking outside
            document.addEventListener('click', function(e) {
                const profileDropdown = document.getElementById('profileDropdown');
                if (profileBtn && dropdownMenu && profileDropdown) {
                    if (!profileBtn.contains(e.target) && !dropdownMenu.contains(e.target)) {
                        dropdownMenu.classList.remove('show');
                        profileDropdown.classList.remove('active');
                    }
                }
            });
            
            // Logout buttons
            const logoutBtns = document.querySelectorAll('#logoutBtn, #sidebarLogout');
            logoutBtns.forEach(btn => {
                btn.addEventListener('click', function(e) {
                    e.preventDefault();
                    if (confirm('Apakah Anda yakin ingin keluar?')) {
                        localStorage.removeItem('user');
                        window.location.href = '../auth/login.html';
                    }
                });
            });
            
            // Theme Toggle
            const themeToggle = document.getElementById('themeToggle');
            if (themeToggle) {
                themeToggle.addEventListener('click', function() {
                    document.body.classList.toggle('dark-mode');
                    const icon = this.querySelector('i');
                    const text = this.querySelector('span');
                    
                    if (document.body.classList.contains('dark-mode')) {
                        icon.className = 'fas fa-sun';
                        text.textContent = 'Mode Terang';
                        localStorage.setItem('theme', 'dark');
                    } else {
                        icon.className = 'fas fa-moon';
                        text.textContent = 'Mode Gelap';
                        localStorage.setItem('theme', 'light');
                    }
                });
                
                // Load saved theme
                const savedTheme = localStorage.getItem('theme');
                if (savedTheme === 'dark') {
                    document.body.classList.add('dark-mode');
                    const icon = themeToggle.querySelector('i');
                    const text = themeToggle.querySelector('span');
                    icon.className = 'fas fa-sun';
                    text.textContent = 'Mode Terang';
                }
            }
            
            // Tab Navigation
            const tabBtns = document.querySelectorAll('.tab-btn');
            const tabContents = document.querySelectorAll('.tab-content');
            
            tabBtns.forEach(btn => {
                btn.addEventListener('click', function() {
                    const tabId = this.dataset.tab;
                    
                    // Update active tab
                    tabBtns.forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    
                    // Show corresponding content
                    tabContents.forEach(content => {
                        content.classList.remove('active');
                        if (content.id === `tab-${tabId}`) {
                            content.classList.add('active');
                        }
                    });
                    
                    // Load data for the tab
                    if (tabId === 'riwayat') {
                        loadProductionHistory();
                    } else if (tabId === 'tanaman') {
                        loadPlantsList();
                        updatePlantStats();
                    }
                });
            });
            
            // Quick Calculator
            const calcJumlah = document.getElementById('calcJumlah');
            const calcHarga = document.getElementById('calcHarga');
            const calcTotal = document.getElementById('calcTotal');
            const applyCalcBtn = document.getElementById('applyCalcBtn');
            
            function updateCalculator() {
                const jumlah = parseFloat(calcJumlah.value) || 0;
                const harga = parseFloat(calcHarga.value) || 0;
                const total = jumlah * harga;
                
                calcTotal.textContent = formatRupiah(total);
            }
            
            if (calcJumlah && calcHarga) {
                calcJumlah.addEventListener('input', updateCalculator);
                calcHarga.addEventListener('input', updateCalculator);
            }
            
            if (applyCalcBtn) {
                applyCalcBtn.addEventListener('click', function() {
                    const jumlah = parseFloat(calcJumlah.value) || 0;
                    const harga = parseFloat(calcHarga.value) || 0;
                    
                    document.getElementById('jumlahProduksi').value = jumlah;
                    document.getElementById('hargaJual').value = harga;
                    
                    // Trigger calculation
                    const event = new Event('input');
                    document.getElementById('jumlahProduksi').dispatchEvent(event);
                    document.getElementById('hargaJual').dispatchEvent(event);
                    
                    alert('Nilai telah diterapkan ke form produksi!');
                });
            }
            
            // Helper function to format currency
            function formatRupiah(angka) {
                return new Intl.NumberFormat('id-ID', {
                    style: 'currency',
                    currency: 'IDR',
                    minimumFractionDigits: 0
                }).format(angka);
            }
            
            // Load plants list
            function loadPlantsList() {
                const plantsList = document.getElementById('plantsList');
                const plants = JSON.parse(localStorage.getItem('plants')) || [];
                
                if (plants.length === 0) {
                    plantsList.innerHTML = `
                        <div class="empty-plants">
                            <i class="fas fa-seedling"></i>
                            <p>Belum ada data tanaman. Tambahkan data tanaman terlebih dahulu.</p>
                        </div>
                    `;
                    return;
                }
                
                const searchTerm = document.getElementById('plantSearch')?.value.toLowerCase() || '';
                const statusFilter = document.getElementById('plantStatusFilter')?.value || 'all';
                
                let filteredPlants = plants;
                
                if (searchTerm) {
                    filteredPlants = filteredPlants.filter(plant => 
                        plant.namaVarietas.toLowerCase().includes(searchTerm) ||
                        plant.lokasiTanam.toLowerCase().includes(searchTerm)
                    );
                }
                
                if (statusFilter !== 'all') {
                    filteredPlants = filteredPlants.filter(plant => plant.statusTanaman === statusFilter);
                }
                
                if (filteredPlants.length === 0) {
                    plantsList.innerHTML = `
                        <div class="empty-plants">
                            <i class="fas fa-search"></i>
                            <p>Tidak ditemukan tanaman dengan kriteria tersebut.</p>
                        </div>
                    `;
                    return;
                }
                
                let html = '';
                filteredPlants.forEach(plant => {
                    const statusClass = {
                        'aktif': 'active',
                        'panen': 'ready',
                        'baru': 'new',
                        'sakit': 'sick',
                        'masa-pemeliharaan': 'maintenance'
                    }[plant.statusTanaman] || '';
                    
                    const statusText = {
                        'aktif': 'Aktif',
                        'panen': 'Siap Panen',
                        'baru': 'Baru',
                        'sakit': 'Sakit',
                        'masa-pemeliharaan': 'Pemeliharaan'
                    }[plant.statusTanaman] || plant.statusTanaman;
                    
                    const age = calculateAge(plant.tanggalTanam);
                    
                    html += `
                        <div class="plant-item ${statusClass}">
                            <div class="plant-icon">
                                <i class="fas fa-seedling"></i>
                            </div>
                            <div class="plant-info">
                                <h4>${plant.namaVarietas}</h4>
                                <div class="plant-details">
                                    <span class="plant-detail">
                                        <i class="fas fa-tree"></i>
                                        ${plant.jumlahBatang} batang
                                    </span>
                                    <span class="plant-detail">
                                        <i class="fas fa-ruler"></i>
                                        ${plant.luasLahan} m²
                                    </span>
                                    <span class="plant-detail">
                                        <i class="fas fa-calendar"></i>
                                        ${age} hari
                                    </span>
                                </div>
                                <p class="plant-location">
                                    <i class="fas fa-map-marker-alt"></i>
                                    ${plant.lokasiTanam}
                                </p>
                            </div>
                            <div class="plant-status">
                                <span class="status-badge ${statusClass}">${statusText}</span>
                                <div class="plant-actions">
                                    <button class="btn-action edit" onclick="editPlant('${plant.id}')">
                                        <i class="fas fa-edit"></i>
                                    </button>
                                    <button class="btn-action delete" onclick="deletePlant('${plant.id}')">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                    `;
                });
                
                plantsList.innerHTML = html;
            }
            
            // Calculate plant age
            function calculateAge(tanggalTanam) {
                const tanamDate = new Date(tanggalTanam);
                const today = new Date();
                const diffTime = Math.abs(today - tanamDate);
                return Math.ceil(diffTime / (1000 * 60 * 60 * 24));
            }
            
            // Update plant statistics
            function updatePlantStats() {
                const plants = JSON.parse(localStorage.getItem('plants')) || [];
                
                const activeCount = plants.filter(p => p.statusTanaman === 'aktif').length;
                const readyCount = plants.filter(p => p.statusTanaman === 'panen').length;
                const newCount = plants.filter(p => p.statusTanaman === 'baru').length;
                const sickCount = plants.filter(p => p.statusTanaman === 'sakit').length;
                
                document.getElementById('plantActiveCount').textContent = activeCount;
                document.getElementById('plantReadyCount').textContent = readyCount;
                document.getElementById('plantNewCount').textContent = newCount;
                document.getElementById('plantSickCount').textContent = sickCount;
                
                // Update footer stats
                const totalPlants = plants.reduce((sum, plant) => sum + (plant.jumlahBatang || 0), 0);
                document.getElementById('dataStats').textContent = 
                    `Total Produksi: ${getTotalProduction()} kg | Total Tanaman: ${totalPlants} batang`;
            }
            
            // Get total production
            function getTotalProduction() {
                const productions = JSON.parse(localStorage.getItem('productions')) || [];
                const total = productions.reduce((sum, prod) => sum + (prod.jumlahProduksi || 0), 0);
                return total.toFixed(1);
            }
            
            // Load production history
            function loadProductionHistory() {
                const productions = JSON.parse(localStorage.getItem('productions')) || [];
                const tbody = document.querySelector('#riwayatProduksi tbody');
                
                if (productions.length === 0) {
                    tbody.innerHTML = `
                        <tr class="empty-row">
                            <td colspan="7" class="empty-state">
                                <i class="fas fa-history"></i>
                                <p>Belum ada data produksi. Mulai dengan input data produksi pertama Anda.</p>
                            </td>
                        </tr>
                    `;
                    updateSummaryInfo(productions);
                    return;
                }
                
                // Apply filters
                const periodFilter = document.getElementById('filterPeriod').value;
                const productFilter = document.getElementById('filterProduct').value;
                
                let filteredProductions = productions;
                
                if (periodFilter !== 'all') {
                    const now = new Date();
                    filteredProductions = filteredProductions.filter(prod => {
                        const prodDate = new Date(prod.tanggal);
                        
                        switch(periodFilter) {
                            case 'today':
                                return prodDate.toDateString() === now.toDateString();
                            case 'week':
                                const weekAgo = new Date(now.getTime() - 7 * 24 * 60 * 60 * 1000);
                                return prodDate >= weekAgo;
                            case 'month':
                                return prodDate.getMonth() === now.getMonth() && 
                                       prodDate.getFullYear() === now.getFullYear();
                            case 'year':
                                return prodDate.getFullYear() === now.getFullYear();
                            default:
                                return true;
                        }
                    });
                }
                
                if (productFilter !== 'all') {
                    filteredProductions = filteredProductions.filter(prod => prod.jenisProduk === productFilter);
                }
                
                if (filteredProductions.length === 0) {
                    tbody.innerHTML = `
                        <tr class="empty-row">
                            <td colspan="7" class="empty-state">
                                <i class="fas fa-filter"></i>
                                <p>Tidak ada data produksi dengan filter yang dipilih.</p>
                            </td>
                        </tr>
                    `;
                    updateSummaryInfo(filteredProductions);
                    return;
                }
                
                // Sort by date (newest first)
                filteredProductions.sort((a, b) => new Date(b.tanggal) - new Date(a.tanggal));
                
                let html = '';
                filteredProductions.forEach(prod => {
                    const productNames = {
                        'daun_segar': 'Daun Segar',
                        'minyak_nilam': 'Minyak Nilam',
                        'sabut_nilam': 'Sabut Nilam',
                        'bibit': 'Bibit',
                        'lainnya': 'Lainnya'
                    };
                    
                    const qualityColors = {
                        'premium': 'success',
                        'standar': 'warning',
                        'ekonomi': 'secondary'
                    };
                    
                    html += `
                        <tr>
                            <td>${formatDate(prod.tanggal)}</td>
                            <td>${productNames[prod.jenisProduk] || prod.jenisProduk}</td>
                            <td>${prod.jumlahProduksi.toFixed(1)} kg</td>
                            <td>${formatRupiah(prod.hargaJual)}</td>
                            <td>${formatRupiah(prod.totalPendapatan)}</td>
                            <td>
                                <span class="quality-badge ${qualityColors[prod.kualitas] || ''}">
                                    ${prod.kualitas}
                                </span>
                            </td>
                            <td>
                                <div class="action-buttons">
                                    <button class="btn-action view" onclick="viewProduction('${prod.id}')">
                                        <i class="fas fa-eye"></i>
                                    </button>
                                    <button class="btn-action delete" onclick="deleteProduction('${prod.id}')">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </div>
                            </td>
                        </tr>
                    `;
                });
                
                tbody.innerHTML = html;
                updateSummaryInfo(filteredProductions);
            }
            
            // Format date
            function formatDate(dateString) {
                const date = new Date(dateString);
                return date.toLocaleDateString('id-ID', {
                    day: 'numeric',
                    month: 'short',
                    year: 'numeric'
                });
            }
            
            // Update summary information
            function updateSummaryInfo(productions) {
                const totalProduction = productions.reduce((sum, prod) => sum + (prod.jumlahProduksi || 0), 0);
                const totalRevenue = productions.reduce((sum, prod) => sum + (prod.totalPendapatan || 0), 0);
                const avgPrice = totalProduction > 0 ? totalRevenue / totalProduction : 0;
                
                document.getElementById('totalProductionSum').textContent = `${totalProduction.toFixed(1)} kg`;
                document.getElementById('totalRevenueSum').textContent = formatRupiah(totalRevenue);
                document.getElementById('avgPriceSum').textContent = formatRupiah(avgPrice);
            }
            
            // Event listeners for filters
            document.getElementById('filterPeriod')?.addEventListener('change', loadProductionHistory);
            document.getElementById('filterProduct')?.addEventListener('change', loadProductionHistory);
            document.getElementById('plantSearch')?.addEventListener('input', loadPlantsList);
            document.getElementById('plantStatusFilter')?.addEventListener('change', loadPlantsList);
            
            // Clear history button
            document.getElementById('clearHistoryBtn')?.addEventListener('click', function() {
                if (confirm('Apakah Anda yakin ingin menghapus semua riwayat produksi?')) {
                    localStorage.removeItem('productions');
                    loadProductionHistory();
                    alert('Riwayat produksi berhasil dihapus!');
                }
            });
            
            // Export buttons
            document.querySelectorAll('.export-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const type = this.classList.contains('pdf') ? 'PDF' :
                               this.classList.contains('excel') ? 'Excel' :
                               this.classList.contains('csv') ? 'CSV' : 'Print';
                    
                    alert(`Fitur ekspor ${type} akan segera tersedia!`);
                });
            });
            
            // Quick guide button
            document.getElementById('quickGuideBtn')?.addEventListener('click', function() {
                alert('Panduan Penggunaan:\n\n1. Pilih tab "Input Produksi Panen" untuk mencatat hasil panen\n2. Pilih tab "Input Data Tanaman" untuk mengelola data tanaman\n3. Gunakan tab "Riwayat Produksi" untuk melihat dan mengelola data historis\n4. Gunakan filter untuk mencari data spesifik\n5. Data otomatis tersimpan di browser Anda');
            });
            
            // Export data button
            document.getElementById('exportDataBtn')?.addEventListener('click', function() {
                const productions = JSON.parse(localStorage.getItem('productions')) || [];
                const plants = JSON.parse(localStorage.getItem('plants')) || [];
                
                if (productions.length === 0 && plants.length === 0) {
                    alert('Belum ada data untuk diekspor.');
                    return;
                }
                
                const data = {
                    productions: productions,
                    plants: plants,
                    exportedAt: new Date().toISOString()
                };
                
                const dataStr = JSON.stringify(data, null, 2);
                const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
                
                const exportFileDefaultName = `nilamtrace-data-${new Date().toISOString().split('T')[0]}.json`;
                
                const linkElement = document.createElement('a');
                linkElement.setAttribute('href', dataUri);
                linkElement.setAttribute('download', exportFileDefaultName);
                linkElement.click();
                
                alert('Data berhasil diekspor sebagai file JSON!');
            });
            
            // Initialize
            loadUserData();
            loadProductionHistory();
            loadPlantsList();
            updatePlantStats();
            
            // Set current date as default
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('tanggal').value = today;
            document.getElementById('tanggalTanam').value = today;
            
            // Update last update time
            document.getElementById('lastUpdate').textContent = 
                `Update Terakhir: ${new Date().toLocaleDateString('id-ID', { 
                    day: 'numeric',
                    month: 'short',
                    year: 'numeric',
                    hour: '2-digit',
                    minute: '2-digit'
                })}`;
            
            // Mobile detection for sidebar
            const isMobile = window.innerWidth <= 1024;
            if (isMobile) {
                sidebar.classList.remove('active');
                overlay.classList.remove('active');
            } else {
                sidebar.classList.add('active');
            }
            
            // Resize handler
            window.addEventListener('resize', function() {
                const isNowMobile = window.innerWidth <= 1024;
                
                if (isNowMobile && !isMobile) {
                    // Switched to mobile
                    sidebar.classList.remove('active');
                    overlay.classList.remove('active');
                    document.body.classList.remove('sidebar-active');
                } else if (!isNowMobile && isMobile) {
                    // Switched to desktop
                    sidebar.classList.add('active');
                }
            });
        });
        
        // Plant management functions
        function editPlant(id) {
            const plants = JSON.parse(localStorage.getItem('plants')) || [];
            const plant = plants.find(p => p.id === id);
            
            if (plant) {
                alert(`Edit tanaman: ${plant.namaVarietas}\n\nFitur edit akan segera tersedia!`);
            }
        }
        
        function deletePlant(id) {
            if (confirm('Apakah Anda yakin ingin menghapus data tanaman ini?')) {
                let plants = JSON.parse(localStorage.getItem('plants')) || [];
                plants = plants.filter(p => p.id !== id);
                localStorage.setItem('plants', JSON.stringify(plants));
                
                // Reload the plants list
                const event = new Event('DOMContentLoaded');
                document.dispatchEvent(event);
                
                alert('Data tanaman berhasil dihapus!');
            }
        }
        
        function viewProduction(id) {
            const productions = JSON.parse(localStorage.getItem('productions')) || [];
            const production = productions.find(p => p.id === id);
            
            if (production) {
                const productNames = {
                    'daun_segar': 'Daun Segar',
                    'minyak_nilam': 'Minyak Nilam',
                    'sabut_nilam': 'Sabut Nilam',
                    'bibit': 'Bibit',
                    'lainnya': 'Lainnya'
                };
                
                alert(`Detail Produksi:\n\nTanggal: ${new Date(production.tanggal).toLocaleDateString('id-ID')}\nJenis: ${productNames[production.jenisProduk] || production.jenisProduk}\nJumlah: ${production.jumlahProduksi} kg\nHarga/kg: Rp ${production.hargaJual.toLocaleString('id-ID')}\nTotal: Rp ${production.totalPendapatan.toLocaleString('id-ID')}\nKualitas: ${production.kualitas}\nKeterangan: ${production.keterangan || '-'}`);
            }
        }
        
        function deleteProduction(id) {
            if (confirm('Apakah Anda yakin ingin menghapus data produksi ini?')) {
                let productions = JSON.parse(localStorage.getItem('productions')) || [];
                productions = productions.filter(p => p.id !== id);
                localStorage.setItem('productions', JSON.stringify(productions));
                
                // Reload the production history
                const event = new Event('DOMContentLoaded');
                document.dispatchEvent(event);
                
                alert('Data produksi berhasil dihapus!');
            }
        }
    </script>
</body>
</html>
